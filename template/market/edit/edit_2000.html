<!DOCTYPE html>
<html>

<head>
<title>[[${str}]] | 营销管理</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link th:href="@{{sp}/css/bootstrap.min.css(sp=${pub_bucket})}" rel="stylesheet">
<link th:href="@{{sp}/font-awesome/css/font-awesome.css(sp=${pub_bucket})}" rel="stylesheet">
<link th:href="@{{sp}/css/animate.css(sp=${pub_bucket})}" rel="stylesheet">
<link th:href="@{{sp}/css/style.css(sp=${pub_bucket})}" rel="stylesheet">
<link th:href="@{{sp}/jqui1114/jquery-ui.css(sp=${pub_bucket})}" rel="stylesheet">
<link th:href="@{{sp}/css/plugins/select2/select2.min.css(sp=${pub_bucket})}" rel="stylesheet">
<script th:src="@{{sp}/kindeditor/kindeditor-min.js(sp=${pub_bucket})}"> </script>
</head>
<script>
    var editor;
    KindEditor.ready(function(K) {
        editor = K.create('textarea[name="mc_content"]', {
            allowFileManager : true
        });
        K('input[name=getHtml]').click(function(e) {
            alert(editor.html());
        });
        K('input[name=isEmpty]').click(function(e) {
            alert(editor.isEmpty());
        });
        K('input[name=getText]').click(function(e) {
            alert(editor.text());
        });
        K('input[name=selectedHtml]').click(function(e) {
            alert(editor.selectedHtml());
        });
        K('input[name=setHtml]').click(function(e) {
            editor.html('<h3>Hello KindEditor</h3>');
        });
        K('input[name=setText]').click(function(e) {
            editor.text('<h3>Hello KindEditor</h3>');
        });
        K('input[name=insertHtml]').click(function(e) {
            editor.insertHtml('<strong>插入HTML</strong>');
        });
        K('input[name=appendHtml]').click(function(e) {
            editor.appendHtml('<strong>添加HTML</strong>');
        });
        K('input[name=clear]').click(function(e) {
            editor.html('');
        });
    });
</script>
<body>
	<div id="wrapper">
		<div th:replace="../../common/nav"></div>
		<div id="page-wrapper" class="gray-bg">
			<div th:replace="../../common/top"></div>   <!-- 顶部 -->
			<div class="row wrapper border-bottom white-bg page-heading">
				<div class="col-lg-10">
					<h2>营销活动</h2>
					<ol class="breadcrumb">
						<li><a href="javascript:;">Home</a></li>
						<li><a href="/market/market/judge">活动选择</a></li>
						<li class="active"><strong>编辑在线选座活动</strong></li>
					</ol>
				</div>
				<div class="col-lg-2"></div>
			</div>
			
			<div class="wrapper wrapper-content animated fadeInRight">
				<div class="row">
					<div class="col-lg-12">
                    	<div class="ibox float-e-margins">
                    		<div class="ibox-title">
								<h5>基本信息</h5>
								<div class="ibox-tools">
									<button type="button" class="btn btn-primary save" th:id="${mInfo.id}">保存</button>
									<a class="collapse-link"> <i class="fa fa-chevron-up"></i></a> 
								</div>
							</div>
							<div class="ibox-content">
								<div class="row">
									<div class="col-sm-6 b-r">
										<form class="form-horizontal">
											<div class="form-group">
												<label class="col-lg-2 control-label">活动名称</label>
												<div class="col-lg-10">
													<input type="text" placeholder="请输入活动名称" class="form-control" name="mc_name" id="mc_name" th:value="${mInfo!=null?mInfo.title:''}">
												</div>
											</div>
											<div class="form-group">
												<label class="col-lg-2 control-label">活动编号</label>
												<div class="col-lg-10">
													<input type="text" placeholder="可手动输入编号，为空则自动生成" class="form-control" name="mc_no" id="mc_no" th:value="${mInfo!=null?mInfo.dnum:''}">
												</div>
											</div>
											<div class="form-group">
												<label class="col-lg-2 control-label">活动简介</label>
												<div class="col-lg-10">
													<input type="text" placeholder="请输入活动简介" name="mc_info" id="mc_info" class="form-control mc_info" th:value="${mInfo!=null?mInfo.info:''}">
												</div>
											</div>
										</form>
									</div>
									<div class="col-sm-6">
										<form class="form-horizontal">
											<div class="form-group">
												<label class="col-lg-2 control-label">活动开始时间</label>
												<div class="col-lg-10">
													<input type="text" placeholder="请选择活动开始时间" class="form-control" name="mc_start_time" id="mc_start_time" th:value="${mInfo!=null?mInfo.start_time:''}">
												</div>
											</div>
											<div class="form-group">
												<label class="col-lg-2 control-label">活动结束时间</label>
												<div class="col-lg-10">
													<input type="text" placeholder="请选择活动结束时间" class="form-control" name="mc_end_time" id="mc_end_time" th:value="${mInfo!=null?mInfo.end_time:''}">
												</div>
											</div>
											<div class="form-group">
												<label class="col-lg-2 control-label">指定用户参加</label>
												<div class="col-lg-10">
													<select class="form-control" id="mc_user_list" name="mc_user_list">
				                                    	<option value="0">不限制</option>
                                                        <option value="1">限制</option>
				                                    </select>
												</div>
											</div>
										</form>
									</div>
								</div>
							</div>
                    	</div>
                    </div>
            	</div>
            	
            	<div class="row">
					<div class="col-lg-12">
                    	<div class="ibox float-e-margins">
                    		<div class="ibox-title">
								<h5>优惠与结算信息记录</h5>
								<div class="ibox-tools">
									<a class="collapse-link"> <i class="fa fa-chevron-up"></i></a> 
									<a class="dropdown-toggle" data-toggle="dropdown" href="javascript:;"><i class="fa fa-wrench"></i></a>
									<ul class="dropdown-menu dropdown-user">
										<li><a href="javascript:;">暂无</a></li>
									</ul>
								</div>
							</div>
							<div class="ibox-content">
								<div class="row">
									<div class="col-sm-5 b-r">
										<form class="form-horizontal">
											<div class="form-group">
												<label class="col-lg-2 control-label">投放方式</label>
												<div class="col-lg-10">
													<select class="form-control" id="l_cal_t_nw">
				                                    	<option value="all">按总量</option>
				                                    	<option value="day">按每天</option>
				                                    </select>
												</div>
											</div>
											<div class="form-group">
												<label class="col-lg-2 control-label">参与方式</label>
												<div class="col-lg-10">
													<select class="form-control" id="cnt_when_create_order">
				                                    	<option value="10">锁座占额</option>
				                                    	<option value="20">出票占额</option>
				                                    </select>
												</div>
											</div>
										</form>
									</div>
									<div class="col-sm-7">
										<form class="form-horizontal">
											<div class="form-group">
												<label class="col-lg-2 control-label">投放金额预算</label>
												<div class="col-lg-10">
													<input type="text" placeholder="请输入投放预算" class="form-control" id="l_cal_t_a">
												</div>
											</div>
											<div class="form-group">
												<label class="col-lg-2 control-label">投放张数预算</label>
												<div class="col-lg-10">
													<input type="text" placeholder="请输入投放张数" class="form-control" id="l_cal_t_n">
												</div>
											</div>
										</form>
									</div>
								</div>
								<div class="hr-line-dashed"></div>
								
								<div class="row">
									<div class="col-sm-5 b-r">
										<form class="form-horizontal">
											<div class="form-group">
												<label class="col-lg-2 control-label">最低票价结算</label>
												<div class="col-lg-10">
													<select id="low_price_settle" class="form-control">
														<option value="0">否</option>
														<option value="1">是</option>
													</select>
												</div>
											</div>
											<div class="form-group">
												<label class="col-lg-2 control-label">结算金额</label>
												<div class="col-lg-10">
													<input type="text" class="form-control" id="l_cal_a" placeholder="高于最低票价结算时输入">
												</div>
											</div>
											<div class="form-group">
												<label class="col-lg-2 control-label">结算对象</label>
												<div class="col-lg-10">
													<input type="text" class="form-control" id="settle_aim" placeholder="记录结算对象，如某某银行">
												</div>
											</div>
										</form>
									</div>
									<div class="col-sm-7">
										<form class="form-horizontal">
											<div class="form-group">
												<label class="col-lg-2 control-label">最低票价票补</label>
												<div class="col-lg-10">
													<select id="l_cal_sw" class="form-control">
														<option value="0">请选择</option>
														<option value="1">影城</option>
														<option value="2">支付方式</option>
														<option value="3">第三方</option>
													</select>
												</div>
											</div>
											<div class="form-group">
												<label class="col-lg-2 control-label">最低票价票补来源</label>
												<div class="col-lg-10">
													<input type="text" class="form-control" id="l_cal_r" placeholder="记录第三方票补信息" disabled>
												</div>
											</div>
											<div class="form-group">
												<label class="col-lg-2 control-label">手续费设置</label>
												<div class="col-lg-10">
													<select name="clear_handle_fee_policy" class="form-control" id="clear_handle_fee_policy">
                                                        <option value="0">正常收取手续费</option>
                                                        <option value="1">免于收取手续费</option>
                                                    </select>
												</div>
											</div>
										</form>
									</div>
								</div>
							</div>
                    	</div>
                    </div>
            	</div>
            	
            	<div class="row">
					<div class="col-lg-12">
                    	<div class="ibox float-e-margins">
                    		<div class="ibox-title">
								<h5>活动价格策略</h5>
								<div class="ibox-tools">
									<a class="collapse-link"> <i class="fa fa-chevron-up"></i></a> 
									<a class="dropdown-toggle" data-toggle="dropdown" href="javascript:;"><i class="fa fa-wrench"></i></a>
									<ul class="dropdown-menu dropdown-user">
										<li><a href="javascript:;">暂无</a></li>
									</ul>
								</div>
							</div>
							<div class="ibox-content">
								<form role="form" class="form-inline">
									<div class="form-group">
										<div class="col-md-12">
											<label for="mc_price_streg">价格策略</label>
											<select name="mc_price_streg" class="form-control" id="mc_price_streg">
												<option value="00">销售价格立减</option>
                                                  	<option value="10">固定折扣销售</option>
                                                  	<option value="20">指定销售价格</option>
                                                  	<option value="50">最低票价减掉</option>
                                              	</select>
										</div>
									</div>
									<div class="form-group">
										<div class="col-md-12">
											<label for="mc_l_mt" class="">影片类型</label>
											<select name="mc_l_mt" class="form-control" id="mc_l_mt">
												<option value="00">不限制</option>
												<option value="2d">2D</option>
												<option value="3d">3D</option>
											</select>
										</div>
									</div>
									<div class="form-group">
										<div class="col-md-12">
											<label for="mc_price_value" class="">价格变动</label>
											<input type="text" name="mc_price_value" placeholder="请输入数字，代表变动价格" class="form-control" id="mc_price_value">
										</div>
									</div>
									<div class="form-group">
										<div class="col-md-12">
											<button type="button" class="btn btn-primary form-control add_new_price_streg">添加一条</button>
										</div>
									</div>
								</form>
								<div class="hr-line-dashed"></div>
							</div>
                    	</div>
                    </div>
            	</div>
            	
            	<div class="row">
					<div class="col-lg-12">
                    	<div class="ibox float-e-margins">
                    		<div class="ibox-title">
								<h5>影片影城限制</h5>
								<div class="ibox-tools">
									<a class="collapse-link"> <i class="fa fa-chevron-up"></i></a> 
									<a class="dropdown-toggle" data-toggle="dropdown" href="javascript:;"><i class="fa fa-wrench"></i></a>
									<ul class="dropdown-menu dropdown-user">
										<li><a href="javascript:;">暂无</a></li>
									</ul>
								</div>
							</div>
							<div class="ibox-content">
								<div class="row">
									<div class="col-sm-6 b-r">
										<form role="form" class="form-horizontal">
											<div class="form-group">
												<label class="col-lg-2 control-label" for="play_date_start">放映开始日期</label>
												<div class="col-lg-10">
													<input type="text" class="form-control" id="play_date_start" placeholder="不输入即不限制" readonly th:value="${detail.plan_start_date}">
												</div>
											</div>
											<div class="form-group">
												<label class="col-lg-2 control-label" for="play_time_start">放映开始时段</label>
												<div class="col-lg-10">
													<input type="text" class="form-control" id="play_time_start" placeholder="不输入即不限制" readonly th:value="${detail.plan_start_time}">
												</div>
											</div>
										</form>
									</div>
									<div class="col-sm-6 b-r">
										<form role="form" class="form-horizontal">
											<div class="form-group">
												<label class="col-lg-2 control-label" for="play_date_end">放映结束日期</label>
												<div class="col-lg-10">
													<input type="text" class="form-control" id="play_date_end" placeholder="不输入即不限制" readonly th:value="${detail.plan_end_date}">
												</div>
											</div>
											<div class="form-group">
												<label class="col-lg-2 control-label" for="play_time_end">放映结束时段</label>
												<div class="col-lg-10">
													<input type="text" class="form-control" id="play_time_end" placeholder="不输入即不限制" readonly th:value="${detail.plan_end_time}">
												</div>
											</div>
										</form>
									</div>
								</div>
								<div class="hr-line-dashed"></div>
								<div class="row">
									<div class="col-sm-12 b-r">
										<form role="form" class="form-horizontal">
											<div class="form-group">
												<label class="col-lg-2 control-label" for="v_mc_l_ms">限制影片</label>
												<div class="col-lg-10">
													<select id="v_mc_l_ms" class="form-control" multiple="multiple">
														<option>请选择影片</option>
													</select>
												</div>
											</div>
										</form>
									</div>
								</div>
								<div class="hr-line-dashed"></div>
								<div class="row">
									<div class="col-sm-12 b-r">
										<form role="form" class="form-horizontal">
											<div class="form-group">
												<label class="col-lg-2 control-label" for="v_mc_l_cs_v">限制影城</label>
												<div class="col-lg-10">
													<select id="v_mc_l_cs_v" class="form-control" multiple="multiple">
														<option>请选择影城</option>
													</select>
												</div>
											</div>
										</form>
									</div>
								</div>
								<div class="hr-line-dashed"></div>
								<div class="row">
									<div class="col-sm-12 b-r">
										<form role="form" class="form-horizontal">
											<div class="form-group">
												<label class="col-lg-2 control-label" for="mc_l_ht">限制影厅类型</label>
												<div class="col-lg-10">
													<select id="mc_l_ht" class="form-control" multiple="multiple">
														<option>请选择影厅</option>
                                                        <option value="1001">普通</option>
                                                        <option value="1002">VIP</option>
                                                        <option value="1003">情侣</option>
                                                        <option value="1004">中国巨幕</option>
                                                        <option value="1005">激光</option>
                                                        <option value="1006">DBOX</option>
													</select>
												</div>
											</div>
										</form>
									</div>
								</div>
								
								<div class="hr-line-dashed"></div>
								<div class="row">
									<div class="col-sm-12">
										<form role="form" class="form-horizontal">
											<div class="form-group">
												<label class="col-lg-2 control-label" for="mc_l_pt">支付方式</label>
												<div class="col-lg-10">
													<select id="mc_l_pt" class="form-control" multiple="multiple">
														<option value="-1">不限制</option>
														<option th:each="pt:${allow_pts}" th:value="${pt.sc_code}">[[${pt.sc_name}]]</option>
													</select>
												</div>
											</div>
										</form>
									</div>
								</div>
								<div class="row">
									<div class="col-sm-12">
										<form role="form" class="form-horizontal">
											<div class="form-group">
												<label class="col-lg-2 control-label" for="mc_l_pay">绑定支付账户</label>
												<div class="col-lg-10">
													<input name="mc_l_pay" type="checkbox" id="mc_l_pay" class="form-control" >
												</div>
											</div>
											<div class="form-group">
												<label class="col-lg-2 control-label" for="mc_l_f">限制首单优惠</label>
												<div class="col-lg-10">
													<input name="mc_l_f" type="checkbox" id="mc_l_f" class="form-control" >
												</div>
											</div>
										</form>
									</div>
								</div>
							</div>
                    	</div>
                    </div>
            	</div>
            	
            	<div class="row">
					<div class="col-lg-12">
                    	<div class="ibox float-e-margins">
                    		<div class="ibox-title">
								<h5>购票规则限制</h5>
								<div class="ibox-tools">
									<a class="collapse-link"> <i class="fa fa-chevron-up"></i></a> 
									<a class="dropdown-toggle" data-toggle="dropdown" href="/scm/goods/index"> <i class="fa fa-wrench"></i></a>
									<ul class="dropdown-menu dropdown-user">
										<li><a href="javascript:;">暂无</a></li>
									</ul>
								</div>
							</div>
							<div class="ibox-content">
								<div class="row">
									<div class="col-sm-4 b-r">
										<form class="form-horizontal">
											<div class="form-group">
												<label class="col-lg-2 control-label">购票数量限制</label>
												<div class="col-lg-10">
													<input type="text" placeholder="0则不限张数" class="form-control" name="mc_l_u" id="mc_l_u">
												</div>
											</div>
										</form>
									</div>
									<div class="col-sm-4 b-r">
										<form class="form-horizontal">
											<div class="form-group">
												<label for="mc_l_u_f" class="col-lg-2 control-label">购票频率限制</label>
												<div class="col-lg-10">
													<select class="form-control" id="mc_l_u_f" name="mc_l_u_f">
				                                    	<option value="-1">活动内</option>
                                                        <option value="d">每天</option>
                                                        <option value="w">每周</option>
                                                        <option value="m">每月</option>
				                                    </select>
												</div>
											</div>
										</form>
									</div>
									<div class="col-sm-4 b-r">
										<form class="form-horizontal">
											<div class="form-group">
												<label for="mc_l_u_v" class="col-lg-2 control-label">购票频率值</label> 
												<div class="col-lg-10">
													<input type="text" class="form-control" id="mc_l_u_v" placeholder="如周一三五，则写1,3,5" disabled>
												</div>
											</div>
										</form>
									</div>
								</div>
							</div>
                    	</div>
                    </div>
            	</div>
            	
            	<div class="row">
            		<div class="col-lg-12">
            			<div class="ibox float-e-margins">
                    		<div class="ibox-title">
								<h5>详细信息</h5>
								<div class="ibox-tools">
									<a class="collapse-link"> <i class="fa fa-chevron-up"></i></a> 
									<a class="dropdown-toggle" data-toggle="dropdown" href="/scm/goods/index"> <i class="fa fa-wrench"></i></a>
									<ul class="dropdown-menu dropdown-user">
										<li><a href="javascript:;">暂无</a></li>
									</ul>
								</div>
							</div>
							<div class="ibox-content">
								<textarea name="mc_content" class="form-control" rows="3" id="mc_content"></textarea>
							</div>
						</div>
            		</div>
            	</div>
            	
            	
            	
            	
            	
            	
            	
            	
            	
            	
            	
            	<!-- 
            	
            	<div class="row">
            		<div class="x_panel">
                            <div class="x_title"></div>
                            <div class="x_content">
                                <div class="col-md-12">
                                    <form class="goodsinfo_form" role="form" id="templatemo-preferences-form" method="post">
                                        <div class="has-success has-feedback">
                                            <div class="row">
                                                <div class="col-md-12 margin-bottom-15">
                                                    <label for="clear_handle_fee_policy" class="control-label">设置手续费政策</label><br/>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12 margin-bottom-15">
                                                <select name="clear_handle_fee_policy" class="form-control margin-bottom-15" id="clear_handle_fee_policy">
                                                    <option value="0">正常收取手续费</option>
                                                    <option value="1">免于收取手续费</option>
                                                </select>
                                            </div>
                                        </div>
                                        <hr/>
                                        
                                        <div class="has-success has-feedback">
                                            <div class="row">
                                                <div class="col-md-12 margin-bottom-15">
                                                    <label for="proj_config" class="control-label">影片影城限制</label><br/>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="has-success has-feedback">
                                            <div class="row">
                                                
                                                <div class="col-md-6 margin-bottom-15">
                                                    <label for="mc_l_cts">限制城市</label> 
                                                    <select id="mc_l_cts" class="form-control margin-bottom-15" multiple="multiple" style="width:100%;">
                                                    	<option>请选择城市</option>
                                                    	<option value="01">朝阳</option>
                                                    	<option value="02">海淀</option>
                                                    	<option value="03">顺义</option>
                                                    	<option value="04">东城</option>
                                                    	<option value="05">西城</option>
                                                    	<option value="06">通州</option>
                                                    	<option value="07">燕郊</option>
                                                    </select>
                                                </div>
                                             </div>
                                        </div>
                                        <hr/>
                                        <div class="row">
                                            <div class="col-md-12 margin-bottom-15">
                                                <label for="mc_content">详细信息</label>
                                                <textarea name="mc_content" class="form-control" rows="3" id="mc_content"></textarea>
                                            </div>
                                        </div>
                                        <div class="row templatemo-form-buttons">
                                            <div class="col-md-12" style="margin-bottom:50px;">
                                                <button type="button" class="btn btn-primary save">保存</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
            	</div>
            	-->
            	
            	
            	
            	
            	
            	
            	
			</div>
			
			<div th:replace="../../common/foot"></div>   <!--  页脚 -->
		</div>
	</div>
	  
    <!-- Mainly scripts -->
    <script th:src="@{{sp}/js/jquery-2.1.1.js(sp=${pub_bucket})}"></script>
    <script th:src="@{{sp}/js/bootstrap.min.js(sp=${pub_bucket})}"></script>
    <script th:src="@{{sp}/js/plugins/metisMenu/jquery.metisMenu.js(sp=${pub_bucket})}"></script>
    <script th:src="@{{sp}/js/plugins/slimscroll/jquery.slimscroll.min.js(sp=${pub_bucket})}"></script>

    <!-- Custom and plugin javascript -->
    <script th:src="@{{sp}/js/inspinia.js(sp=${pub_bucket})}"></script>
    <script th:src="@{{sp}/js/plugins/pace/pace.min.js(sp=${pub_bucket})}"></script>
    
    <script th:src="@{{sp}/third/layer3/layer.js(sp=${pub_bucket})}" type="text/javascript"></script>
    <script th:src="@{{sp}/js/plugins/select2/select2.full.min.js(sp=${pub_bucket})}" type="text/javascript"></script>
    
    <script th:src="@{{sp}/jqui1114/jquery-ui.js(sp=${pub_bucket})}" type="text/javascript" charset="utf-8"></script>
    <script th:src="@{{sp}/jqui1114/jquery-ui-timepicker-addon.js(sp=${pub_bucket})}" type="text/javascript" charset="utf-8"></script>
    <script th:src="@{{sp}/jqui1114/jquery-ui-timepicker-zh-CN.js(sp=${pub_bucket})}" type="text/javascript" charset="utf-8"></script>
</body>
<script type="text/javascript">
$(".save").on("click", function() {
	var market_id = $(this).attr("id");
	var mc_name = $("#mc_name").val();//活动名称
	var mc_no = $("#mc_no").val();//活动编号
	var mc_info = $("#mc_info").val();//活动简介
	var mc_start_time = $("#mc_start_time").val();//活动开始时间
	var mc_end_time = $("#mc_end_time").val();//结束时间
	var mc_user_list = $("#mc_user_list").val();//是否限制用户列表参加
	
	var l_cal_t_nw = $("#l_cal_t_nw").val();//投票限制模式
	var cnt_when_create_order = $("#cnt_when_create_order")[0].checked ? 1 : 0;//是否锁座
	var l_cal_t_n = $("#l_cal_t_n").val();//投放限制张数
	var l_cal_t_a = $("#l_cal_t_a").val() ? parseInt($("#l_cal_t_a").val())*100 : "";//投放金额
	
	var mc_l_ms = "";
	var mc_l_ms_name = "";//限制影片
	$("#v_mc_l_ms option:selected").each(function(){
		if(mc_l_ms_name){mc_l_ms_name += ",";}
		if(mc_l_ms){mc_l_ms += ",";}
		mc_l_ms += $(this).val();
		mc_l_ms_name += $(this).html();
	});
	var mc_l_cs = "";
	var mc_l_cs_name = "";//限制影城
	$("#v_mc_l_cs_v option:selected").each(function(){
		if(mc_l_cs_name){mc_l_cs_name += ",";}
		if(mc_l_cs){mc_l_cs += ",";}
		mc_l_cs += $(this).val();
		mc_l_cs_name += $(this).html();
	});
	
	var mc_l_cts = "";
	var mc_l_cts_name = "";//限制城市
	$("#mc_l_cts option:selected").each(function(){
		if(mc_l_cts){mc_l_cts += ",";}
		if(mc_l_cts_name){mc_l_cts_name += ",";}
		mc_l_cts += $(this).val();
		mc_l_cts_name += $(this).html();
	});
	
	var mc_l_ht = "";
	var mc_l_ht_name = "";//限制影厅
	$("#mc_l_ht option:selected").each(function(){
		if(mc_l_ht){mc_l_ht += ",";}
		if(mc_l_ht_name){mc_l_ht_name += ",";}
		mc_l_ht += $(this).val();
		mc_l_ht_name += $(this).html();
	});
	
	var mc_l_pt = "-1";//限制支付方式
	$("input[name='mc_l_pt']:checked").each(function() {
		mc_l_pt = mc_l_pt + "," + $(this).val();
	});
	if(mc_l_pt!="-1") {
		mc_l_pt = mc_l_pt.substring(3);
	}
	
	var mc_l_f = $("#mc_l_f")[0].checked ? 1 : 0;//限制首单优惠
	
	var mc_l_pay = $("#mc_l_pay")[0].checked ? 1 : 0;//限制支付账户
	
	
	var mc_l_u = $("#mc_l_u").val();//购票数量限制
	var mc_l_u_f = $("#mc_l_u_f").val();//购票频率限制
	var mc_l_u_v = $("#mc_l_u_v").val();//具体购票频率值
	
	
	var l_cal_sw = $("#l_cal_sw").val()+","+$("#l_cal_sw option:selected").html();//最低票价票补设置
	var l_cal_a = $("#l_cal_a").val();//结算金额
	var l_cal_r = $("#l_cal_r").val();//第三方票补信息
	
	var l_plays = $("#play_time_start").val();//放映时间段开始
	var l_playe = $("#play_time_end").val();//放映时间段结束
	//处理放映时间
	var s_l_plays = l_plays.split(":");
	var s_l_playe = l_plays.split(":");
	if(parseInt(s_l_plays[0])>parseInt(s_l_playe[0])){
           layer.msg("放映结束时间须大于放映开始时间", {icon: 2});
           return;
	}else if(parseInt(s_l_plays[0])==parseInt(s_l_playe[0])){
		if(parseInt(s_l_plays[1])>parseInt(s_l_playe[1])){
	           layer.msg("放映结束时间须大于放映开始时间", {icon: 2});
	           return;
		}
	}
	var mc_content = editor.html();//营销活动详细信息
	
	var l_pds = $("#play_date_start").val();//放映开始日期
	var l_pde = $("#play_date_end").val();//放映结束日期
	
	//处理放映日期
	var s_l_pds = l_pds.split("-");
	var s_l_pde = l_pde.split("-");
	if(parseInt(s_l_pds[1])>parseInt(s_l_pde[1])){
           layer.msg("放映结束时间须大于放映开始时间", {icon: 2});
           return;
	}else if(parseInt(s_l_pds[1])==parseInt(s_l_pde[1])){
		if(parseInt(s_l_pds[2])>parseInt(s_l_pde[2])){
	           layer.msg("放映结束时间须大于放映开始时间", {icon: 2});
	           return;
		}
	}
	
	//处理新增字段
	var low_price_settle = $("#low_price_settle").val();//是否最低票价结算
	var settle_aim = $("#settle_aim").val();//结算对象
	var clear_handle_fee_policy = $("#clear_handle_fee_policy").val();//手续费政策
	//alert(low_price_settle + "---" + settle_aim + "---" + clear_handle_fee_policy);
	
	if(mc_name==null||mc_name.trim()=="") {
		layer.msg("请输入营销活动名称", {icon: 2});
		return;
	}
	if(mc_info==null||mc_info.trim()=="") {
		layer.msg("请输入营销活动描述", {icon: 2});
		return;
	}
	if(mc_start_time==null||mc_start_time==""||mc_end_time==null||mc_end_time=="") {
		layer.msg("请设置活动进行的时间段", {icon: 2});
		return;
	}
	var sp_start_time = mc_start_time.trim().split(" ");
	var sp_end_time = mc_end_time.trim().split(" ");
	var s_day = sp_start_time[0].split("-");
	var s_time = sp_start_time[1].split(":");
	var	e_day = sp_end_time[0].split("-");
	var e_time = sp_end_time[1].split(":");
	
	//时间处理
	if(parseInt(s_day[1])>parseInt(e_day[1])){
           layer.msg("结束时间须大于开始时间", {icon: 2});
           return;
	}else if(parseInt(s_day[1])==parseInt(e_day[1])){
		if(parseInt(s_day[2])>parseInt(e_day[2])){
            layer.msg("结束时间须大于开始时间", {icon: 2});
            return;
		}else if(parseInt(s_day[2])==parseInt(e_day[2])){
			if(parseInt(s_time[0])>parseInt(e_time[0])){
	            layer.msg("结束时间须大于开始时间", {icon: 2});
	            return;
			}else if(parseInt(s_time[0])==parseInt(e_time[0])){
	            if(parseInt(s_time[1])>parseInt(e_time[1])){
		            layer.msg("结束时间须大于开始时间", {icon: 2});
		            return;
	            }
			}
		}
	}
	
	var mc_p_streg = null;
	let mc_p_streg_msg = null;
	$("select[name='mc_price_streg']").each(function() {
		var t_v = $(this).val();
		if(t_v!='00'&&t_v!='10'&&t_v!='20'&&t_v!='50') {
			//layer.msg("请选择正确价格策略类型", {icon: 2});
			mc_p_streg_msg = "请选择正确价格策略类型"
			return;
		} else {
			var mc_price_value = $(this).parent().parent().parent().find("input[name='mc_price_value']").val();//营销价格变动值
			if(mc_price_value==null||mc_price_value.trim()=="") {
				//layer.msg("请输入正确价格策略变动值", {icon: 2});
				mc_p_streg_msg = "请输入正确价格策略变动值"
				return;
			}
		}
		var mc_p_s_t = $(this).parent().parent().parent().find("select[name='mc_l_mt']").val();//是否限制影片类型
		var mc_p_s_v = $(this).parent().parent().parent().find("input[name='mc_price_value']").val();//营销价格变动值
		if(mc_p_s_t!="00") {
			mc_p_s_v = mc_p_s_t + ":" + mc_p_s_v;
		}
		mc_p_s_v = t_v + "/" + mc_p_s_v;
		if(mc_p_streg==null) {
			mc_p_streg = mc_p_s_v; 
		} else {
			mc_p_streg = mc_p_streg + ";" + mc_p_s_v;
		}
	});
	if(mc_p_streg_msg) {
		layer.msg(mc_p_streg_msg, {icon: 2});
		return;
	}
	// begin to post
	var index = layer.load();
	var url = "[[${contextPath}]]/market/do_add_update_2000/?" + Date.parse(new Date());
	$.post(url, {
			id: market_id,
			mc_type:'2000',//1
			mc_name:mc_name,//活动名称 1
			mc_no:mc_no,//编号1
			mc_info:mc_info,//活动描述1
			mc_p_streg:mc_p_streg,//价格策略
			mc_start_time:mc_start_time,//活动开始时间1
			mc_end_time:mc_end_time,//活动结束时间1
			mc_user_list:mc_user_list,//是否限制用户列表参加
			mc_l_ms:mc_l_ms,//限制影片value 1
			mc_l_cs:mc_l_cs,//限制影城value 1
			mc_l_pt:mc_l_pt,//限制支付方式1
			mc_l_u:mc_l_u,//具体购票频率值
			mc_l_u_f:mc_l_u_f,//购票频率限制
			mc_l_u_v:mc_l_u_v,//具体购票频率值
			mc_content:mc_content,//营销活动详细信息1
			mc_l_f:mc_l_f,//限制首单优惠1
			mc_l_pay:mc_l_pay,//限制支付账户1
			mc_l_cts:mc_l_cts,//限制城市 1
			l_cal_t_n:l_cal_t_n,//投放限制张数1
			l_cal_t_a:l_cal_t_a,//投放金额1
			l_cal_sw:l_cal_sw,//最低票价票补设置 1
			l_cal_a:l_cal_a,//结算金额1
			l_cal_r:l_cal_r,//第三方票补信息1
			mc_l_ht:mc_l_ht,//限制影厅value  1
			low_price_settle:low_price_settle,//是否最低票价结算1
			settle_aim:settle_aim,//结算对象 1
			clear_handle_fee_policy:clear_handle_fee_policy,//手续费政策1
			l_cal_t_nw:l_cal_t_nw,//投票限制模式1
			l_plays:l_plays,//放映时间段开始1
			l_playe:l_playe,//放映时间段结束1
			mc_l_cwro:cnt_when_create_order,//是否锁座1
			l_pds:l_pds,//放映开始日期1
			l_pde:l_pde,//放映结束日期1
			}, function(data){
		layer.close(index);
		if(data.available) {
			layer.alert('操作成功', {
		        skin: 'layui-layer-lan',
		        shift: 4 //动画类型
		    }, function(){
		    	location.href = "/market/market/index?" + new Date().getTime();					    	
		    });
		} else {
			var code = data.messages[0];
			var msg = data.messages[1];
			layer.alert(msg, {icon : 2});
		}
	});
});
</script>
<script type="text/javascript">
$(function() {
	var post_err_msg = "[[${error_msg}]]";
    if(post_err_msg){
        layer.msg(post_err_msg, {icon: 2}); 
    }
    var number_policy = "[[${detail.number_policy}]]";
    number_policy = number_policy.split(",");
    $("#mc_l_u").val(number_policy[0]);
    if (number_policy.length > 1) {
    	$("#mc_l_u_f").val(number_policy[1]);
    }
    if (number_policy.length > 2) {
    	$("#mc_l_u_v").val(number_policy[2]);
    }

    var limit_movies = "[[${detail.limit_movies}]]";
    limit_movies = limit_movies.split(",");

    //ajax处理显示限制影片、影城、城市
    //影片
    $.post("[[${contextPath}]]/common/movieListInfoList",function(data){
    	if(data.available) {
    		for(var i=0;i<data.obj.length;i++){
        		var o =data.obj[i]
        		$("#v_mc_l_ms").append("<option value=\""+o.label+"\">"+o.value+"</option>");
        	}
    	}
    	$("#v_mc_l_ms").select2({placeholder:'选择参与活动的影片，为空则不限制'});
    	if (limit_movies.length > 0) {
			$("#v_mc_l_ms").val(limit_movies).trigger('change');
		}
    });
    
    //影城
    var store_id = "[[${detail.store_id}]]";
    $.post("[[${contextPath}]]/common/storeInfoList",function(data){
    	if(data.available) {
    		for(var i=0;i<data.obj.length;i++){
        		var o =data.obj[i]
        		$("#v_mc_l_cs_v").append("<option value=\""+o.id+"\">"+o.store_name+"</option>");
        	}
    	}
    	$("#v_mc_l_cs_v").select2({placeholder:'选择参与活动的影城，为空则不限制'});
    	$("#v_mc_l_cs_v").val(store_id).trigger('change');
    });

    //影厅
    var limit_halls = "[[${detail.limit_halls}]]";
    limit_halls = limit_halls.split(",");
    $("#mc_l_ht").select2({placeholder:'暂不支持影厅类型选择'});
    if (limit_halls.length > 0) {
    	$("#mc_l_ht").val(limit_halls).trigger('change');
    }

    //支付方式
    $("#mc_l_pt").select2({placeholder:'限定支付方式'});
});
</script>
<script type="text/javascript">
$("#l_cal_t_n").on("change", function() {
	var v = $.trim($(this).val());
	if (v != null && v != "") {
		if (isNaN(v)) {
			$(this).val("");
			layer.msg("请输入合法的投放张数数值", {
				icon : 2
			});
		} else {
			if (parseFloat(v) <= 0) {
				$(this).val("");
				layer.msg("请输入合法的投放张数数值", {
					icon : 2
				});
			}
		}
	}
});
$("#l_cal_t_a").on("change", function() {
	var v = $.trim($(this).val());
	if (v != null && v != "") {
		if (isNaN(v)) {
			$(this).val("");
			layer.msg("请输入合法的投放张数数值", {
				icon : 2
			});
		} else {
			if (parseFloat(v) <= 0) {
				$(this).val("");
				layer.msg("请输入合法的投放张数数值", {
					icon : 2
				});
			}
		}
	}
});
$("#low_price_settle").on("change", function() {
	var v = $(this).val();
	if (v == "1") {
		$("#l_cal_a").val("");
		$("#l_cal_a").attr("disabled", "disabled");

		$("#l_cal_sw").val("0");
		$("#l_cal_sw").attr("disabled", "disabled");

		$("#l_cal_r").val("");
		$("#l_cal_r").attr("disabled", "disabled");
	} else {
		$("#l_cal_a").removeAttr("disabled");
		$("#l_cal_sw").removeAttr("disabled");
		$("#l_cal_r").removeAttr("disabled");
	}
});
$("#l_cal_a").on("change", function() {
	var v = $.trim($(this).val());
	$(this).val(v);
	if (v != null && v != "") {
		if (isNaN(v)) {
			$(this).val("");
			layer.msg("请输入合法的结算金额数值", {
				icon : 2
			});
		} else {
			if (parseFloat(v) <= 0) {
				$(this).val("");
				layer.msg("请输入合法的投放张数数值", {
					icon : 2
				});
			}
		}
	}
});
</script>
<script type="text/javascript">
$("#l_cal_sw").on("change", function() {
	var v = $(this).val();
	if (v == "3") {
		$("#l_cal_r").removeAttr("disabled");
	} else {
		$("#l_cal_r").val("");
		$("#l_cal_r").attr("disabled", "disabled");
	}
});
//开始时间
$("#mc_start_time").datetimepicker({
       showSecond: true,
       timeFormat: 'hh:mm:ss',
       stepHour: 1,
       stepMinute: 1,
       stepSecond: 1
   });
//结束时间
$("#mc_end_time").datetimepicker({
       showSecond: true,
       timeFormat: 'hh:mm:ss',
       stepHour: 1,
       stepMinute: 1,
       stepSecond: 1
   });
//添加活动价格策略
$(".add_new_price_streg").on("click", function() {
	var mc_price_streg = $(this).parent().parent().find("select[name='mc_price_streg']").val();
	var mc_l_mt = $(this).parent().parent().find("select[name='mc_l_mt']").val();
	var mc_price_value = $(this).parent().parent().find("input[name='mc_price_value']").val();
	
	var invalid = false;
	$("input[name='mc_price_value']").each(function() {
		var mc_price_value = $(this).val();
		if(mc_price_value==null||mc_price_value.trim()==""||isNaN(mc_price_value)) {
			$(this).parent().parent().find("input[name='mc_price_value']").val("");
			invalid = true;
			return;
		}
	});
	if(invalid) {
		layer.msg("请输入合法的变动价格数值", {icon: 2});
		return;
	}
	
	var html = '<form role="form" class="form-inline">';
	html = html + '<div class="form-group">';
	html = html + '<div class="col-md-12">';
	html = html + '<label for="mc_price_streg">价格策略</label>';
	html = html + '<select name="mc_price_streg" class="form-control" id="mc_price_streg">';
	html = html + '<option value="00">销售价格立减</option>';
	html = html + '<option value="10">固定折扣销售</option>';
	html = html + '<option value="20">指定销售价格</option>';
	html = html + '</select>';
	html = html + '</div>';
	html = html + '</div>';
	
	html = html + '<div class="form-group">';
	html = html + '<div class="col-md-12">';
	html = html + '<label for="mc_l_mt" class="">影片类型</label>';
	html = html + '<select name="mc_l_mt" class="form-control" id="mc_l_mt">';
	html = html + '<option value="00">不限制</option>';
	html = html + '<option value="2d">2D</option>';
	html = html + '<option value="3d">3D</option>';
	html = html + '</select>';
	html = html + '</div>';
	html = html + '</div>';
	
	html = html + '<div class="form-group">';
	html = html + '<div class="col-md-12">';
	html = html + '<label for="mc_price_value" class="">价格变动</label>';
	html = html + '<input type="text" name="mc_price_value" placeholder="请输入数字，代表变动价格" class="form-control" id="mc_price_value">';
	html = html + '</div>';
	html = html + '</div>';
	
	html = html + '<div class="form-group">';
	html = html + '<div class="col-md-12">';
	html = html + '<button type="button" class="btn btn-primary del_price_streg">删除此项</button>';
	html = html + '</div>';
	html = html + '</div>';
	
	html = html + '</form>';
	
	$(this).parent().parent().parent().after(html);
	
	$(".del_price_streg").on("click", function() {
		$(this).parent().parent().parent().fadeOut("fast", function() {
			$(this).remove();
		});
	});
});

//影片影城限制
$("#play_time_start").datetimepicker({
	timeOnly:true,
	datepicker:false,
	step:5,
	    format:'H:i',
	onShow:function( currentDateTime ){
	this.setOptions({
	maxTime:$(".enddatepicker").val()?$(".enddatepicker").val():false
	});
	},
	onChangeDateTime:function( currentDateTime ){
	this.setOptions({
	maxTime:$(".enddatepicker").val()?$(".enddatepicker").val():false
	});
	}
});

$("#play_time_end").datetimepicker({
	timeOnly:true,
	datepicker:false,
	step:5,
	    format:'H:i',
	onShow:function( currentDateTime ){
	this.setOptions({
	maxTime:$(".enddatepicker").val()?$(".enddatepicker").val():false
	});
	},
	onChangeDateTime:function( currentDateTime ){
	this.setOptions({
	maxTime:$(".enddatepicker").val()?$(".enddatepicker").val():false
	});
	}
});

$("#play_date_start").datepicker();
$("#play_date_end").datepicker();

//购票时间约束
$("#mc_l_u_f").on("change", function() {
	var v = $(this).val();
	if(v=="w"||v=="m") {
		$("#mc_l_u_v").removeAttr("disabled");
	} else {
		$("#mc_l_u_v").val("");
		$("#mc_l_u_v").prop("disabled", true);
	}
});
</script>
</html>
